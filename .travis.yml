language: php

sudo: false

env:
  global:
    - secure: "j0IW4yiZgitKYscKhkD6l1I+Z2QttJkLdhUu1c5oefvQ7SF7a7PPRbbpqXcv7ooPVX5T93oNftA2vZXMbss1h+hMXmLycksb738PacoceiJFXmbVSqtLYP+/szdd8GOy9WWZPvNvDT7gabTSUjn59/OGEAFl5D3+Yjr40fx4AM4nIInkuF6NBYX6aVEgEbauycQedkyREHSGmYydl80d2VxOdto2QFC85V/GYFY+/J/WSAz7zQMPIEj1Udo2YbFnNPRuWH2mFKCYahowCNXTax8p7MYp5pTXbpcwV3r7vwhLTVR777tnWZYLRrLnZ0joW44L3IJcvjBE7EqcpGESOnN1rbJQSIhYxdCCXTbOSZW3ed1blWHyM+lvcbEpTxD6pskr0n39zQRNe9YIK4iSiUyFUWp+wfAV1kRBFqVXo8hn4gz95hyzCW2KUpdQYDmFAe46EDKb4fk3iW1ZU/MfVoENo5Y9F/j2QcygJiAPg71EuYOhAyzDC7dnvZ0sOxQzBPnwULNoasZp0r4Ukp7Yrbz8le6dIJc66zV5Xes35LXtBSTuV6o+wi/yqmHGYoL6bAMPx+rY2eEu8TR0s8BYHdJAjK7epAET418p+UmEK2/DI63YIbseGTmSissVW7oXWGgHPhKU2Qv7ijGx4XYECwPO+IOLiZDL10yd0vg8r/0="
    - secure: "SjmcbMkZD/5s40AN8Xw9euob2AtOfdTnj6wPEnK2DNlEGPz9QY/fxe/vsh+BvQfsomhlGT4nrOPxw4VXvG4FnqBEzddsSnQBjrhH3X0LzTdPACQClKToshWAretf9/++XyVBLZO11xB/ykQIpBNoLiPVV7t5+dQS3fc4hSp+anYBAOjE5aO9tnjHOn/q8UprS12dX2G4Cw0YWAAWaPOBE8DqVzydgteL4iQ/Dvaqt9twpwbUc4l2wQRo+Wxr+C56jGBe6BeR/wbsi+uTBmr3z+Oi8lq0P1Ka+QfGZbWEEQ/pbt/GZhhNpocy3SWnCV4YHiiVjMcEISdaqmhQjb61KHmUsBVRGO5afJV4da61cT+ezUt9gQ7EIECisiatC4iRP/vMa03OFtBAVPmqP59iMVgbqFDU8VSbwyOGtbuwLbRpGyeaFnuzmJNQwQzj6Fdx9L/k2crvFDz2ejR82Y5lQTRnnLWV9Qgy+qOpcHKwnN5TE4C6RlT69hC0HTpci9NIPt6o6ehQH5ZmanP+HzRnusqt4p7/FblijjtfsOaliU0gA6KCsisUN5NSX5JPFRyz31K14Jfw+BIbFcQ2mI9hEEXuKvQU9Sv+oCQaBqeRmbwMRhB8ZlB0KqW9J3k5Mx/p/EkI59DPC5qTyAJk2rILwKGcqIcyJnWojgWgmN+ijLI="

matrix:
  include:
    - php: 7.1
      env: WITH_CS=true WITH_COVERAGE=true

cache:
  directories:
    - $HOME/.composer/cache
    - $HOME/.php-cs-fixer

before_install:
  - source .travis/xdebug.sh
  - xdebug-disable
  - composer validate
  - composer config github-oauth.github.com $GITHUB_TOKEN

install:
  - composer install

before_script:
  - mkdir -p "$HOME/.php-cs-fixer"
  - mkdir -p build/logs

script:
  - if [[ "$WITH_CS" == "true" ]]; then vendor/bin/php-cs-fixer fix --config=.php_cs --diff --dry-run --verbose; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-enable; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/phpunit --configuration=test/Unit/phpunit.xml --coverage-clover=build/logs/clover.xml; else vendor/bin/phpunit --configuration=test/Unit/phpunit.xml; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-disable; fi
  - vendor/bin/phpunit --configuration=test/Integration/phpunit.xml

after_success:
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/test-reporter --coverage-report=build/logs/clover.xml; fi

notifications:
  email: false
