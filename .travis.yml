language: php

sudo: false

env:
  global:
    - secure: "ygfzNLK+02cUrjop3Poctikr68L2C3Z4tZ00TrfSsp38VwVv9iI5bSBek519OO1DE35rIYh2YlryQr8oKXCqZunUv/qVrm+krYjsstk+xJzKMjkbb+O1wcYLUDqFm7TeyWD6upgAKg5n5WbDSuxgFe4fmvDX/qf4GbM3pbb3UYvOF3a/Rr18WUXwpYldVB165qJWUyChT4t+BUXB+o953SJsviTv3sBe9jdYhcipzMUIhuOPyhKaDjZJkBG9FPhlbYixkFMgaNiPRf7grhMkFMcwCdSUues0bkBLo4CZFg80uqBTxqy0zq1cXrJ8kLzy9WYUOj42DIFYmyfoYYX28/QgyiC8TjpfOLF9zbiDccsOCgIBrV59BV5kdyoY7JuINNsUnnskF6svu9p++VU7rQLcjDS+lh9B9FArerWPhOOUg6LDwe9Gz2Ymh/fhb92+r7UUE6dwaRxytNkAzRxsVCkNNJG9mx4vOGtnBefqDIK3MyAbqztpiBjvEadJdcu/SieFugx9QqrRxl3KVAhKkYNxtxWjuY9OSUgzZXblCrsdp+A/gbQI/se61taWpxJBnqf16TsxYNGeAbeA8SPZFXNpidbd4dlCAMcKPBL3S47ndjKe4yBuySJEMHx2BLUlGa1tdhAj5bTKsf21NTrEgaT2ZfwIiJP/LnaOZP0wlws="
    - secure: "vl+2Z/YDQ2ZvjS4SAivZ4ANArWYUAsN/HmWVfCNrBv9Bbr0Ygp2lHMLjrvWptTx/wcGkA7IxwJhAnHHXHitohiBrEVNpZBOwtz4sWWzEZFn4k/fsmmgWPjpokvlrfqszkE1xMpffNAeSQsxnXJbOtw4UPO04Wdh1f0jqTX4Z8j1LgLyEOQOzBEHvZIYx/yniwXqrpM6eH+ntn4a2UVJP/zKTXpLLxMnoaASAFq8EfiShZoBU5KHGT7w6CrzpfW5DRuJWaHBC7p22OJj3RtqLDEftGOiaSZ0VtE/xmirBt0wmRlfwSx127NImyiBtBSaEM6AIRR6OhL+9xnz0JrWi6nqhmDO09yWQWAJEa9031+UVkui1+RO0bzGlyF6ciRQgTR4CkIP80dd8gzp3gmMpcclaEAQW2co7/CUY7augQV0cCsoMlVk7yiJ2UqcBFdAHb8gKO8h3NTSJXEcokfVf1pLJYdNE5TAcv4bKZRRj1hHd1+R6wVK6SgJbhZIwxfBr105tRgJVwMFbtNvinF1OssQ+UUNavbDwVkq5hfXK7w1Z728ZaIMMosD624YrEEM0Oi0Q4MhofpFgGo09QDzxRmede4p85qS6jhxr/nJ3h+rwrRqtVxVUcdGmsHHAeqTZ/hpVGTGv8roO406vmzQKVi0Me3HodEnq4XKPfdw/CH8="

matrix:
  include:
    - php: 7.1
      env: WITH_CS=true WITH_COVERAGE=true

cache:
  directories:
    - $HOME/.composer/cache
    - $HOME/.php-cs-fixer

before_install:
  - source .travis/xdebug.sh
  - xdebug-disable
  - composer validate
  - composer config github-oauth.github.com $GITHUB_TOKEN

install:
  - composer install

before_script:
  - mkdir -p "$HOME/.php-cs-fixer"
  - mkdir -p build/logs

script:
  - if [[ "$WITH_CS" == "true" ]]; then vendor/bin/php-cs-fixer fix --config=.php_cs --diff --dry-run --verbose; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-enable; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/phpunit --configuration=test/Unit/phpunit.xml --coverage-clover=build/logs/clover.xml; else vendor/bin/phpunit --configuration=test/Unit/phpunit.xml; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-disable; fi
  - vendor/bin/phpunit --configuration=test/Integration/phpunit.xml

after_success:
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/test-reporter --coverage-report=build/logs/clover.xml; fi

notifications:
  email: false
