language: php

sudo: false

env:
  global:
    - secure: "h35naZz00FdsqHrbU+L3S7+kc9YkjTpTIflj5FxgOg7n9D8gy0H91eVjB47NYvjbJOYemcgfFWkFdp91p90dhYdMuHFkKFnXgVPRm009efTGeT4WPJqhBNEYxN/BtF6JM27PkoaKPppcH0+yEQPUkLSLyG2v27C/uY9OsSkbJuIIOEV2aB/h0FxvoRWi/JsWL43+H0d0l82JjzQmZ9qLqgPA2J+prYE4K4z0cQ//CSbI0WlZefnixMEpx+qz/PU7aAFGyHaWzx7I1FBtIX/bhXx0JK2VfP8HZyvPTQXvWLmW6CCseF9sjPPGD84W3wopBWgqBweUSylh/d/xP6oYKae4tLH+4FEdra5LNP331lSRuDrLJNBtD1mv83HUYA77LcRO7Pv0VQhEyLNHo44vydGvMNRJnJ52dbrL09h2D41O26Q28yt9cD6Y1yuYQ5ovwkmM9EqOFCkyA/WIuG7bbZ2QLuNRcLg2yGS/4Io39JX+bB52dmkP2oYZJ8cT/wj7PWTU7ECfKuyFIQInFjSBhxUqOEe0mUpHKi3NHGUZhD0/wNn1EBk+RpvHLKUAkW0AxEHzx35V7wFNwQUVCtuYBv/cjH58Q5Ers33/fy7WDNtfhtcACHjCIQ8flEusc0JfHMJ2CmIJAOMWc40Ydeu5hPdAcBEEaqShyI0T3RKN80w="
    - secure: "SjmcbMkZD/5s40AN8Xw9euob2AtOfdTnj6wPEnK2DNlEGPz9QY/fxe/vsh+BvQfsomhlGT4nrOPxw4VXvG4FnqBEzddsSnQBjrhH3X0LzTdPACQClKToshWAretf9/++XyVBLZO11xB/ykQIpBNoLiPVV7t5+dQS3fc4hSp+anYBAOjE5aO9tnjHOn/q8UprS12dX2G4Cw0YWAAWaPOBE8DqVzydgteL4iQ/Dvaqt9twpwbUc4l2wQRo+Wxr+C56jGBe6BeR/wbsi+uTBmr3z+Oi8lq0P1Ka+QfGZbWEEQ/pbt/GZhhNpocy3SWnCV4YHiiVjMcEISdaqmhQjb61KHmUsBVRGO5afJV4da61cT+ezUt9gQ7EIECisiatC4iRP/vMa03OFtBAVPmqP59iMVgbqFDU8VSbwyOGtbuwLbRpGyeaFnuzmJNQwQzj6Fdx9L/k2crvFDz2ejR82Y5lQTRnnLWV9Qgy+qOpcHKwnN5TE4C6RlT69hC0HTpci9NIPt6o6ehQH5ZmanP+HzRnusqt4p7/FblijjtfsOaliU0gA6KCsisUN5NSX5JPFRyz31K14Jfw+BIbFcQ2mI9hEEXuKvQU9Sv+oCQaBqeRmbwMRhB8ZlB0KqW9J3k5Mx/p/EkI59DPC5qTyAJk2rILwKGcqIcyJnWojgWgmN+ijLI="

matrix:
  include:
    - php: 7.1
      env: WITH_CS=true WITH_COVERAGE=true

cache:
  directories:
    - $HOME/.composer/cache
    - $HOME/.php-cs-fixer

before_install:
  - source .travis/xdebug.sh
  - xdebug-disable
  - composer validate
  - composer config github-oauth.github.com $GITHUB_TOKEN

install:
  - composer install

before_script:
  - mkdir -p "$HOME/.php-cs-fixer"
  - mkdir -p build/logs

script:
  - if [[ "$WITH_CS" == "true" ]]; then vendor/bin/php-cs-fixer fix --config=.php_cs --diff --dry-run --verbose; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-enable; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/phpunit --configuration=test/Unit/phpunit.xml --coverage-clover=build/logs/clover.xml; else vendor/bin/phpunit --configuration=test/Unit/phpunit.xml; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-disable; fi
  - vendor/bin/phpunit --configuration=test/Integration/phpunit.xml

after_success:
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/test-reporter --coverage-report=build/logs/clover.xml; fi

notifications:
  email: false
