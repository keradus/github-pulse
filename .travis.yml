language: php

sudo: false

env:
  global:
    - secure: "ygfzNLK+02cUrjop3Poctikr68L2C3Z4tZ00TrfSsp38VwVv9iI5bSBek519OO1DE35rIYh2YlryQr8oKXCqZunUv/qVrm+krYjsstk+xJzKMjkbb+O1wcYLUDqFm7TeyWD6upgAKg5n5WbDSuxgFe4fmvDX/qf4GbM3pbb3UYvOF3a/Rr18WUXwpYldVB165qJWUyChT4t+BUXB+o953SJsviTv3sBe9jdYhcipzMUIhuOPyhKaDjZJkBG9FPhlbYixkFMgaNiPRf7grhMkFMcwCdSUues0bkBLo4CZFg80uqBTxqy0zq1cXrJ8kLzy9WYUOj42DIFYmyfoYYX28/QgyiC8TjpfOLF9zbiDccsOCgIBrV59BV5kdyoY7JuINNsUnnskF6svu9p++VU7rQLcjDS+lh9B9FArerWPhOOUg6LDwe9Gz2Ymh/fhb92+r7UUE6dwaRxytNkAzRxsVCkNNJG9mx4vOGtnBefqDIK3MyAbqztpiBjvEadJdcu/SieFugx9QqrRxl3KVAhKkYNxtxWjuY9OSUgzZXblCrsdp+A/gbQI/se61taWpxJBnqf16TsxYNGeAbeA8SPZFXNpidbd4dlCAMcKPBL3S47ndjKe4yBuySJEMHx2BLUlGa1tdhAj5bTKsf21NTrEgaT2ZfwIiJP/LnaOZP0wlws="
    - secure: "HYCt5BmIgwaxm+H84Foi49vsBxu/ZN6cdzwpCT76b8r0czCWBLQjzrwKiAmkhumg8kRG3pERbKBo53djHvrEyZ0VSmvm4SJFw+GVzNobAt5JCbbrc/ifwGBrFc5QC9z4jDx0VMZ/zIBaVwLFPlGAfIjHJ6DS4/xYUf80us7JgcTp3okXcAPPpznsQ2LdMMMU8qGARYX9tpjYeq0Zjhpz2qVV0DB+EnIM0/lOuZI6jQjSi1PKF7D5qSThekmmxSZ3gUcLfQ0tx51ELcZ8ZelO1HzYni6zGknjQselCTuAKjWCxChJmaC1gSS3zAK9519OJE1eLVLxGxbmoeDcQXA3KbhbWCx/BSRgSfuooAqlQuOoz5oYCA4FXpgsudNQ24xrSu9IAUytXowF1th3XhHdAQ/soAbQgPC+AA5qvuBxMJAYyJ9Xgpu2EUcddbZlM/CR6IwYRLof/EXoReFwVtumSSwpn9YVXckd4lT9QurNdUIn014O2do5DWs+Ghj71XCtDlAvUYqNP8KlnjQtuEW9WxZubgsZ/egu5kKHhvcfKNjnMozaDNcs0vmHvQSof99k5FJtIq4sAWnLLSYQqGkq4Jl6JqTT4AZFmR5toNDjPRT7sXdz3Ygnu8NPEZUU9BtwDvcklYCijkecYclGrFNHK709Eg5IRl6M09y4NZp0aAA="

matrix:
  include:
    - php: 7.1
      env: WITH_CS=true WITH_COVERAGE=true

cache:
  directories:
    - $HOME/.composer/cache
    - $HOME/.php-cs-fixer

before_install:
  - source .travis/xdebug.sh
  - xdebug-disable
  - composer validate
  - composer config github-oauth.github.com $GITHUB_TOKEN

install:
  - composer install

before_script:
  - mkdir -p "$HOME/.php-cs-fixer"
  - mkdir -p build/logs

script:
  - if [[ "$WITH_CS" == "true" ]]; then vendor/bin/php-cs-fixer fix --config=.php_cs --diff --dry-run --verbose; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-enable; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/phpunit --configuration=test/Unit/phpunit.xml --coverage-clover=build/logs/clover.xml; else vendor/bin/phpunit --configuration=test/Unit/phpunit.xml; fi
  - if [[ "$WITH_COVERAGE" == "true" ]]; then xdebug-disable; fi
  - vendor/bin/phpunit --configuration=test/Integration/phpunit.xml

after_success:
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/test-reporter --coverage-report=build/logs/clover.xml; fi

notifications:
  email: false
